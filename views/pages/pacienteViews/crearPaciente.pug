doctype html
html(lang="en")
    head
        meta(charset="UTF-8")
        meta(name="viewport", content="width=device-width, initial-scale=1.0")
        title Crear Paciente
        script(src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js")
    body
        h1= create ? 'Crear Nuevo Paciente' : 'Actualizar Paciente'
        form(action=`/paciente/${create ? 'crear' : 'actualizar'}`, method='POST')
          input(type='text', name='nombre_paciente', placeholder='Nombre', required)
          input(type='text', name='apellido_paciente', placeholder='Apellido', required)
          input(type='text', name='documento_paciente', placeholder='Documento', required)
          input(type='date', name='fecha_nac', placeholder='Fecha de Nacimiento', required)
          select(name='sexo_paciente', required)
            option(value='Masculino') Masculino
            option(value='Femenino') Femenino
            option(value='Otro') Otro
          label(for="obraSocialSelect") Obra Social
          select#obraSocialSelect(name="id_os")  
            option(value="") Seleccione una obra social
              each os in obras_sociales
                option(value=os.id_os) #{os.nombre_os}
          label(for="planSelect") Plan
          select#planSelect(name="id_plan") 
            option(value="") Seleccione un plan
          button(type='submit')= create ? 'Crear' : 'Actualizar'
        script.
          $(document).ready(function() {
            $('#obraSocialSelect').change(function() { 
              const obraSocialID = $(this).val();
              if (obraSocialID) {
                $.ajax({
                  url: `/paciente/planes/${obraSocialID}`,
                  method: 'GET',
                  success: function(data) {
                    $('#planSelect').empty();
                    $('#planSelect').append(new Option('Selecciona un plan', ''));
                    data.forEach(plan => {
                      $('#planSelect').append(new Option(plan.plan, plan.id_plan));
                    });
                  },
                  error: function(err) {
                    console.error('Error al obtener los planes: ', err);
                  }
                });
              } else {
                $('#planSelect').empty();
                $('#planSelect').append(new Option('Seleccione un plan', ''));
              }
            });
          });