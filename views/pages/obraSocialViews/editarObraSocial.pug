extends ../../layout

block content
    .container.mt-5
        .row
            .col-md-8
                h1 Editar Obra Social
                #error-message.alert.alert-danger.hidden(style="display:none;") La obra social debe tener al menos un plan

                form(id="editObraSocialForm" method="POST" action=`/obraSocial/editar/${obraSocial.id_os}`)
                    // Formulario de edición de obra social

                    .form-group
                        label(for="nombre_os") Nombre de la Obra Social
                        input.form-control(type="text" id="nombre_os" name="nombre_os" value=obraSocial.nombre_os required)

                    // Campo para agregar un nuevo plan
                    .form-group
                        label(for="plan") Nombre del Plan
                        .input-group
                            input.form-control(type="text" id="plan" placeholder="Agregar un nuevo plan")
                            .input-group-append
                                button#addPlanBtn.btn.btn-success(type="button")
                                    i.fa.fa-plus

                    // Campo hidden para enviar los planes en el formulario
                    input#planesHidden(type="hidden" name="planes" value=`${JSON.stringify(planes)}`)

                    // Panel que muestra los planes agregados
                    .form-group
                        label Planes agregados
                        ul#planesList.list-group
                            each plan in planes
                                li.list-group-item.d-flex.justify-content-between.align-items-center
                                    | #{plan}
                                    button.btn.btn-danger.btn-sm.remove-plan Eliminar

                    // Botones de Guardar y Cancelar
                    button.btn.btn-success(type="submit") Guardar
                    a.btn.btn-secondary(href='/obraSocial') Cancelar

            // Panel lateral derecho para información adicional (opcional)
            .col-md-4
                h3 Información Adicional
                // Aquí podrías agregar cualquier información adicional como estadísticas o descripciones de la obra social

    script(src="https://code.jquery.com/jquery-3.6.0.min.js")

    script.
        $(document).ready(function() {

            // Funcionalidad para agregar un nuevo plan
            $('#addPlanBtn').on('click', function() {
                const plan = $('#plan').val().trim();
                
                if (plan !== '') {
                    // Verifica que el plan no esté ya en la lista
                    if (!planes.includes(plan)) {
                        planes.push(plan);
                        $('#planesList').append(`
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                ${plan}
                                <button type="button" class="btn btn-danger btn-sm remove-plan">Eliminar</button>
                            </li>
                        `);
                        // Actualiza el campo hidden con los planes
                        $('#planesHidden').val(JSON.stringify(planes));
                        // Limpia el input de plan
                        $('#plan').val('');
                    } else {
                        alert('Este plan ya ha sido agregado.');
                    }
                }
            });

            // Funcionalidad para eliminar un plan
            $('#planesList').on('click', '.remove-plan', function() {
                const planToRemove = $(this).parent().text().trim().replace('Eliminar', '').trim();
                
                // Elimina el plan de la lista
                planes = planes.filter(plan => plan !== planToRemove);
                $('#planesHidden').val(JSON.stringify(planes));

                // Remueve el elemento de la lista visual
                $(this).parent().remove();
            });

            // Capturar el submit del formulario para verificar si hay al menos un plan
            $('#editObraSocialForm').on('submit', function(e) {
                if (planes.length === 0) {
                    e.preventDefault();
                    $('#error-message').show();
                }
            });
        });
